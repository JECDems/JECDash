name: Update JSON File

on:
  schedule:
    - cron: '15 18 * * 4' # This schedules the action to run at 17:30 UTC on Thursdays.
    
jobs:
  update-json:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      
    - name: Set up R
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.1.0' 
      
    - name: Install dependencies
      run: |
        Rscript -e "install.packages(c('dplyr', 'tidyr', 'jsonlite', 'remotes'), dependencies = TRUE)"
        Rscript -e "remotes::install_github('JECDems/JECTools')"
        
    - name: Set API Credentials
      env:
        FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
        BLS_API_KEY: ${{ secrets.BLS_API_KEY }}
      run: |
        echo "FRED_API_KEY=${FRED_API_KEY}" > .Renviron
        echo "BLS_API_KEY=${BLS_API_KEY}" >> .Renviron
        
    - name: Run convertToJson.R script
      run: Rscript R/convertToJson.R 
      
    - name: Commit changes
      run: |
        git config --global user.name 'Alfredo Romero'
        git config --global user.email 'Alfredo_Romero@jec.senate.gov'
        git add unemploymentActions.JSON
        git commit -m 'Update unemployment JSON file' || echo "No changes to commit"
        git push
